# β 与阈值矩阵敏感性分析报告

## 实验背景

在 NEXUS 的 TEMPORAL 模式下，LIF 神经元的膜电位动力学为：

```
V(t+1) = β × V(t) + I(t)
若 V(t+1) >= threshold: 发放脉冲, 软重置 V = V - threshold
```

本报告分析 β 和 threshold 两个参数对 SNN 输出的敏感性差异。

---

## 一、β 参数敏感性分析

### 1.1 β 的物理意义

根据代码 `neurons.py:365`：
```python
v.mul_(beta).add_(x)  # 即 v = v * beta + x
```

- β 是膜电位的**保留率**（Retention Rate）
- 公式：`V(t+1) = β × V(t) + I(t)`
- β = 1.0 → 保留 100%（IF 神经元，无衰减）
- β = 0.9 → 保留 90%
- β = 0.5 → 保留 50%
- β 越大 → 保留越多
- β 越小 → 保留越少
- 默认值：β = 1.0 - 1e-7 ≈ 0.9999999（近似完全保留）

### 1.2 β 扰动实验结果

基准配置：10 samples, 96 timesteps, β_base = 0.01

| 扰动幅度 | β 测试值 | 脉冲位差异 |
|---------|---------|-----------|
| +0.001  | 0.011   | 0         |
| +0.01   | 0.02    | 0         |
| +0.05   | 0.06    | 0         |
| +0.1    | 0.11    | 0         |
| +0.2    | 0.21    | 0         |
| +0.3    | 0.31    | 0         |
| +0.5    | 0.51    | 0         |
| +0.9    | 0.91    | 0         |

### 1.3 β 对膜电位残差的保留效果

在 TEMPORAL 模式下测试（输入序列 [1,0,0,1,1,0,1,0,0,1]）：

| β 值  | 最终膜电位 | 总发放次数 |
|------|-----------|-----------|
| 0.0  | 0.0000    | 5         |
| 0.5  | 0.0156    | 5         |
| 0.9  | 0.3487    | 5         |
| 0.99 | 0.9044    | 5         |

β 越大，膜电位残差保留越多（如 β=0.99 时最终膜电位 0.9044），但在测试配置中未导致输出脉冲翻转。

---

## 二、阈值矩阵敏感性分析

### 2.1 逻辑门标准阈值

| 逻辑门 | 标准阈值 |
|-------|---------|
| AND   | 1.5     |
| OR    | 0.5     |
| NOT   | 1.0     |

### 2.2 时间残差演化（AND 门，β=0.9）

输入序列：[1,1], [0,0], [1,1], [0,0], [1,1]

**threshold=1.3:**
| t | I | V_before | V_after | spike |
|---|---|----------|---------|-------|
| 0 | 2 | 0.0000   | 0.7000  | 1     |
| 1 | 0 | 0.7000   | 0.6300  | 0     |
| 2 | 2 | 0.6300   | 1.2670  | 1     |
| 3 | 0 | 1.2670   | 1.1403  | 0     |
| 4 | 2 | 1.1403   | 1.7263  | 1     |

**threshold=1.5:**
| t | I | V_before | V_after | spike |
|---|---|----------|---------|-------|
| 0 | 2 | 0.0000   | 0.5000  | 1     |
| 1 | 0 | 0.5000   | 0.4500  | 0     |
| 2 | 2 | 0.4500   | 0.9050  | 1     |
| 3 | 0 | 0.9050   | 0.8145  | 0     |
| 4 | 2 | 0.8145   | 1.2330  | 1     |

**threshold=1.7:**
| t | I | V_before | V_after | spike |
|---|---|----------|---------|-------|
| 0 | 2 | 0.0000   | 0.3000  | 1     |
| 1 | 0 | 0.3000   | 0.2700  | 0     |
| 2 | 2 | 0.2700   | 0.5430  | 1     |
| 3 | 0 | 0.5430   | 0.4887  | 0     |
| 4 | 2 | 0.4887   | 0.7398  | 1     |

阈值越高，软重置后残余膜电位越低。

### 2.3 Linear 层阈值分布

SpikeFP32Linear_MultiPrecision(1, 2) 包含 534 个 LIF 节点：

| 阈值  | 节点数量 | 对应门类型 |
|------|---------|-----------|
| 0.50 | 133     | OR 门     |
| 1.00 | 158     | NOT 门    |
| 1.50 | 243     | AND 门    |

### 2.4 Linear 层阈值扰动测试

**短序列（96 时间步）：**

| 阈值偏移 | 脉冲总和 | vs base diff |
|---------|---------|-------------|
| -0.40   | 640     | 0           |
| -0.20   | 640     | 0           |
| 0.00    | 640     | 0           |
| +0.20   | 640     | 0           |
| +0.40   | 640     | 0           |

**长序列（100 时间步）：**

| 阈值偏移 | 总位差异 | 有差异时间步数 |
|---------|---------|--------------|
| -0.5    | 45      | 1            |
| -0.3    | 0       | 0            |
| -0.2    | 0       | 0            |
| -0.1    | 0       | 0            |
| 0.0     | 0       | 0            |
| +0.1    | 19      | 2            |
| +0.2    | 19      | 2            |
| +0.3    | 19      | 2            |
| +0.5    | 169     | 10           |

---

## 三、β vs 阈值敏感性对比（100 时间步，β_base=0.9）

| 参数类型 | 扰动幅度 | 总位差异 | 有差异时间步数 |
|---------|---------|---------|--------------|
| 阈值    | +0.05   | 19      | 2            |
| β       | -0.05   | 0       | 0            |
| 阈值    | +0.10   | 19      | 2            |
| β       | -0.10   | 2       | 2            |
| 阈值    | +0.20   | 19      | 2            |
| β       | -0.20   | 2       | 2            |
| 阈值    | +0.30   | 19      | 2            |
| β       | -0.30   | 2       | 2            |

---

## 四、实验结论

### 4.1 β 敏感性

1. 在测试配置下，β 变化对最终输出脉冲无影响
2. β 是保留率，影响亚阈值膜电位残差的保留程度（β 越大保留越多）
3. β 扰动需要足够大的幅度且足够长的序列才能导致输出变化

### 4.2 阈值敏感性

1. 阈值直接影响发放判断（V >= threshold）和软重置量（V = V - threshold）
2. 相同扰动幅度下，阈值扰动产生的位差异约为 β 扰动的 10 倍
3. 阈值 +0.05 即产生 19 位差异，β -0.05 产生 0 位差异

### 4.3 敏感性对比

| 维度     | β 参数（保留率）            | 阈值参数       |
|---------|---------------------------|---------------|
| 影响机制 | 膜电位保留率（β越大保留越多） | 发放判断+重置量 |
| 响应延迟 | 累积效应，需多步            | 即时生效      |
| 敏感程度 | 较低                       | 较高（~10x）   |

---

## 五、实验文件

- `debug_beta_perturbation_size.py` - β 扰动幅度分析
- `debug_beta_why_zero.py` - β diff=0 原因分析
- `debug_beta_temporal_residue.py` - β 时间残差效应
- `debug_threshold_analysis.py` - 阈值综合分析
- `debug_threshold_sensitivity.py` - 阈值敏感性测试
- `debug_threshold_deep.py` - 阈值深入分析
